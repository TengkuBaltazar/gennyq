package life.genny.gadaq.inference;

import life.genny.qwandaq.message.QDataAnswerMessage;
import life.genny.qwandaq.utils.KafkaUtils;
import life.genny.qwandaq.models.UserToken;
import life.genny.qwandaq.utils.BaseEntityUtils;
import life.genny.qwandaq.Answer;
import org.apache.commons.lang3.text.WordUtils;

ruleflow-group 'Inference'

rule InferenceLog 
when
	answer: Answer()
then
	String sourceCode = answer.getSourceCode();
	String targetCode = answer.getTargetCode();
	String attributeCode = answer.getAttributeCode();
	String value = answer.getValue();
	System.out.println("Inferring GENNYQ! Source Code: " + sourceCode + " Target Code: " + targetCode + " Attribute Code: " + attributeCode + " Value: " + value);
end

rule InferFirstName 
when
	answer: Answer( attributeCode == "PRI_FIRSTNAME" )
	beUtils : BaseEntityUtils()
then
	System.out.println("InferFirstName fired!");
	String firstName = answer.getValue().toLowerCase().trim();
	firstName = WordUtils.capitalize(firstName);

	String lastName = (String) beUtils.getBaseEntityValue(answer.getTargetCode(), "PRI_LASTNAME");
	if (lastName == null) {
		return;
	}
	lastName = WordUtils.capitalize(lastName);
	String name = firstName + " " + lastName;

	insert(new Answer(answer.getSourceCode(), answer.getTargetCode(), "PRI_NAME", name));
end
